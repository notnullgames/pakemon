local StateExploitDemo = {}

local menu = {}
local currentItem = 1
local camera

function StateExploitDemo:enter()
  camera = Camera(160, 120)
  currentItem = 1
  menu = {}
  local q = pakemon.exploitdb:query("SELECT id, description, file FROM exploits WHERE description LIKE '%apache%'")
  while q:step() do
    local item = {
      id = q:get_value(0),
      description = q:get_value(1),
      file = q:get_value(2)
    }
    table.insert(menu, { item.description, function() print(item.id .. ": " .. item.description) end })
  end
  q:finalize()
end

function StateExploitDemo:update(dt)
  if currentItem > 14 then
      camera:lookAt(160, 120 + (currentItem - 14) * 15 )
  else
      camera:lookAt(160, 120)
  end
end

function StateExploitDemo:draw()
  camera:attach()
  love.graphics.setColor(1,1,1,1)
  for i, menuItem in pairs(menu) do
      if currentItem == i then
          love.graphics.print("â€¢", 10, (i * 15) + 15)
      end
      love.graphics.print(menuItem[1], 20, (i * 15) + 15)
  end
  camera:detach()
end

function StateExploitDemo:pressed(button)
  if button == 'b' then
    Gamestate.switch(StateMainMenu)
  end
  
  if button == 'up' then
      currentItem =  currentItem - 1
      if currentItem < 1 then
          currentItem = #menu
      end
      SoundMove:stop()
      SoundMove:play()
  end
  if button == 'down' then
      currentItem =  currentItem + 1
      if currentItem > #menu then
          currentItem = 1
      end
      SoundMove:stop()
      SoundMove:play()
  end
  
  -- OK
  if button == 'a' or button == 'start' then
      menu[currentItem][2]()
      SoundOk:play()
  end
end

return StateExploitDemo