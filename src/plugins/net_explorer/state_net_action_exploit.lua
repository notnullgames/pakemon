local StateNetActionExploit = {}

-- this will hold the log of the output
local exploits = {}

local function getPortsForMac(mac)
    output = ""
    local net = httpGetJson("http://127.0.0.1:8081/api/session/lan")
    if net and net.hosts then
        for i,host in pairs(net.hosts) do
            if host.mac and host.mac == mac and host.meta and host.meta.values and host.meta.values.ports then
                -- do exploit search here via stuff in host
            end
        end
    end
end

-- periodically update ports-list

local timerhandle

function StateNetActionExploit:enter()
    bettercap("syn.scan "..self.host.ipv4)
    timerhandle = Timer.every(2, function() data = getPortsForMac(self.host.mac)  end)
    getPortsForMac(self.host.mac)
end

function StateNetActionExploit:leave()
    bettercap("syn.scan off")
    Timer.cancel(timerhandle)
end

function StateNetActionExploit:draw()
    RpgLook:drawBox(0, 0, 320, 60)
    
    love.graphics.setFont(FontBasic)
    love.graphics.setColor(1, 1, 1, 1)
    
    RpgLook:drawFace(macToDec(self.host.mac), 10, 5, 0.5, 0.5)
    love.graphics.print(shortenText(self.host.hostname, 36), 70, 10)
    love.graphics.print(shortenText(self.host.ipv4, 36), 70, 25)
    love.graphics.print(shortenText(self.host.mac, 36), 70, 40)

    RpgLook:drawBox(0, 60, 320, 180)

    love.graphics.setColor(1, 1, 1, 1)

    love.graphics.printf("Exploit list will go here.",5, 65, 310)
end

function StateNetActionExploit:pressed(button)
    if button == "b" then
        Gamestate.switch(StateNetExplorer)
    end
end

return StateNetActionExploit
