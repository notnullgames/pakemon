-- requires this installed: luarocks install luasql-sqlite3

local driver = require "luasql.sqlite3"

-- this is the real root dir
local realdir = love.filesystem.getRealDirectory('plugins')

local StateExploitDemo = {}

-- this holds the results
local results = {}

-- this is for the database
local env
local con


-- this is a helper for doing simpler database queries (using an iterator)
function query(sql_statement)
  local cursor = assert (con:execute (sql_statement))
  return function ()
    return cursor:fetch()
  end
end


function StateExploitDemo:enter()
	-- setup database
	env = assert (driver.sqlite3())
	con = assert (env:connect(realdir .. '/plugins/exploit_demo/exploits.sqlite'))
	
	-- perform a query
	for id, description, file in query("SELECT id, description, file FROM exploits WHERE description LIKE '%apache%'") do
		print(string.format('%s: %s', id, description))
	end
end

function StateExploitDemo:leave()
	-- clean up database
	con:close()
	env:close()
end

function StateExploitDemo:pressed(button)
    if button == "b" then
        Gamestate.switch(StateMainMenu)
    end
end

return StateExploitDemo